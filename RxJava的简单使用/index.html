<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="一个Android开发者的成长记录"><title>RxJava的简单使用 | chenlong's</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?c429fdd6ac00b6f7e59c44c7b27894b8";
var s = document.getElementsByTagName("script")[0]; 
s.parentNode.insertBefore(hm, s);
})();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">RxJava的简单使用</h1><a id="logo" href="/.">chenlong's</a><p class="description">Android开发技术博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 全部</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">RxJava的简单使用</h1><div class="post-meta">Oct 8, 2016<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span></div><div class="post-content"><h3 id="0x00-介绍"><a href="#0x00-介绍" class="headerlink" title="0x00 介绍"></a>0x00 介绍</h3><p>先简单介绍一下这个库，Rx的一系列实现都是为了解决同一个问题，就是让异步编程变的更加简单。它的主要思想是使用观察者模式，分离了数据源和数据的使用者，同时它拓展了观察者模式，将数据源中的数据抽象成数据流，在此之上，通过操作符来处理流中的数据，具有非常好的拓展性。RxJava/RxAndroid是针对通用Java平台和Android平台的具体实现，详细文档可以参考官方网站 <a href="http://reactivex.io" target="_blank" rel="external">reactivex.io</a>。</p>
<h3 id="0x01-基本概念"><a href="#0x01-基本概念" class="headerlink" title="0x01 基本概念"></a>0x01 基本概念</h3><p>首先我们来看一下几个关键的概念。</p>
<p><strong>1.可观察对象：Observable</strong></p>
<p>这是RxJava中的核心元素，它是对数据源的一次包装，让一个普通数据源，变成一个可观察的对象，后续的操作都是建立在这个基础之上的，我们可以简单的把它理解成观察者模式中的<em>主题</em></p>
<p><strong>2.观察者：Observer</strong></p>
<p>有可观察的对象，那么必然会有观察者，Observer就是对观察者的包装，借助它我们具有了从Observable中获取数据的能力</p>
<p>以上两个概念，我们在观察者模式中同样可以看到，并没有什么稀奇。接下来的几个概念就是对观察者模式的拓展。</p>
<p><strong>3.操作符：Operator</strong></p>
<p>在最开始我们提到，Rx中数据源中的数据被抽象成数据流，对于数据流，我们简单的理解为一个未知长度的数组，我们可以对这个数组进行过滤，映射等操作，而所有的这些操作在Rx中都被定义为Operator。</p>
<p><strong>4.调度器：Scheduler</strong></p>
<p>既然Rx是一个用来处理异步操作的库，那么在不同的线程上执行不同的操作是一个必须有的功能，相比于通常的线程调度，Rx将线程切换定义成了一个操作符，非常简单的实现了线程调度的功能。</p>
<p>上述就是Rx中的几个重要的概念，当然，Rx是一个非常强大的库，内部的实现远不止这些，但是作为一个初学者，我们先了解到这里。</p>
<h3 id="0x02-简单尝试"><a href="#0x02-简单尝试" class="headerlink" title="0x02 简单尝试"></a>0x02 简单尝试</h3><p>下面我们来简单的写几行代码，感受一下RxJava的魅力。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fj4f8lu26xj30zc11843j.jpg" alt=""></p>
<p>上面的代码展示了RxJava的基本使用方式，演示了几个基本的操作符和线程调度，我们可以发现，使用RxJava进行异步操作，有以下几个优点：</p>
<ol>
<li>代码的可读性大幅提高，基本可以达到代码文档化。</li>
<li>线程调度简单方便，避免了一系列的回调。</li>
<li>支持链式调用。</li>
<li>对异常的统一处理，这一点尤为关键。在RxJava中，异常作为数据流的一部分，被逐级传递，我们可以在最终使用数据的地方进行统一处理，避免了多次的try catch。</li>
</ol>
<h3 id="0x03-实战"><a href="#0x03-实战" class="headerlink" title="0x03 实战"></a>0x03 实战</h3><p>我们尝试一下，将RxJava简单的应用到我们的项目中，先举个栗子，在审批详情页中，有这样一个逻辑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">从网络获取数据 -&gt; 如果已经被删除 -&gt; 退出页面</div><div class="line">            -&gt; 如果有数据 -&gt; 将数据反序列化成对象 -&gt; 对数据进行预处理 -&gt; 展示数据</div></pre></td></tr></table></figure>
<p>我们先来看一下原始的代码是怎么写的，如图所示。</p>
<p><img src="http://i13.tietuku.cn/dd048b325e63b376.png" alt=""></p>
<p>借助Bolts库的Task类，反序列化和预处理被放入异步线程中执行，然后再切换到主线程渲染页面，这个过程说不上错误，但是，并不优雅，当然也有优化的空间，我们看一下使用Task如何优化这个调用过程。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcly1fj4faqp1xzj30y20zkgqr.jpg" alt=""></p>
<p>为了让错误能够在最终的处理过程中被处理，我们不得不创建了一个新的类<code>ApprovalResult</code>，这个类封装了预处理后的数据和错误信息，然后切换到主线程，执行错误处理或者渲染页面。</p>
<p>总的来说，比原始的代码要好看了一点，减少了一层嵌套的回调。那么，如果使用RxJava，这段代码我们要怎么写呢？请看下图。</p>
<p><img src="http://i13.tietuku.cn/eed7fb1d0ce81af0.png" alt=""></p>
<p>首先一点，我们不必再为传递错误创建一个新的model，其次，操作符的链式调用更能直观的反应代码的逻辑，虽然代码看上去变长了，但是，读起来并没有什么障碍。</p>
<h3 id="0x04-结论"><a href="#0x04-结论" class="headerlink" title="0x04 结论"></a>0x04 结论</h3><p>通过上述简单的分析，我们可以大概的看出RxJava在处理异步操作时的能力，由于目前我对RxJava的理解还比较粗浅，所以对它的应用还停留在非常基础的层面上。实际上，RxJava的应用场景非常广泛。例如:</p>
<ol>
<li>和<a href="http://square.github.io/retrofit/" target="_blank" rel="external">Retrofit</a>结合，将网络请求的结果包装成Observable</li>
<li><a href="https://github.com/JakeWharton/RxBinding" target="_blank" rel="external">RxBinding</a>，这是一个对View控件的封装，将View的产生的click，touch事件转换成Observable</li>
<li><a href="https://github.com/AndroidKnife/RxBus" target="_blank" rel="external">RxBus</a>，一个使用RxJava实现的EventBus</li>
</ol>
<p>当然，RxJava也有它的问题：</p>
<ol>
<li>这个库上手颇有难度。</li>
<li>源码不太好读，包含大量的泛型 </li>
<li>包含大概4300个方法和域，对于Android来说，是一个比较大的库了。</li>
</ol>
<p>以上就是我对RxJava目前的认识，还非常浅薄，后续我会继续学习这个库的高级用法，尽请期待下一期，《RxJava的进阶使用》</p>
</div><div class="tags"></div><div class="post-nav"><a href="/插件化之Activity的启动流程/" class="pre">插件化之Activity的启动流程</a><a href="/插件化之Activity生命周期的hook/" class="next">插件化之Activity生命周期的hook</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Gradle/">Gradle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/">ReactNative</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作/">工作</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/插件化/">插件化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机/">计算机</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">chenlong's.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>